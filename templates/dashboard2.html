{% extends 'base.html' %}
{% block content %}
<h2>Sleep Insights</h2>

<!-- Data insights -->
<section class="data-insights">
    <p>Average sleep per night: {{ '{0:0.1f}'.format(avg_sleep) }} hours</p>
    <p>Median sleep per night: {{ '{0:0.1f}'.format(median_sleep) }} hours</p>
    <p>Average insomnia severity: {{ '{0:0.1f}'.format(avg_insom_severity) }} / 10</p>
    <p>Median insomnia severity: {{ '{0:0.1f}'.format(median_insom_severity) }} / 10</p>
</section>

<section class="data-insights">
    <p>Your most frequent type of insomnia is {{ most_frequent_type_insomnia }} insomnia.</p>
</section>

<section class="data-insights"> 
    <p>Insomnia happens more frequently when you also X.</p>
</section>



<!-- First donut chart element -->
<div class="melon-chart">
    <canvas id="donutChart"></canvas>
    <div id="donutLegend" class="chart-legend"></div>
    <form id = "date-range" action = '/insom-types.json'>
        Start date: <input type="date" name="start_date">
        End date: <input type="date" name="end_date">
        <input type="submit">
    </form>
</div>

<!-- Second donut chart element -->
<div class="melon-chart">
    <canvas id="donutChart2"></canvas>
    <div id="donut2Legend" class="chart-legend"></div>
</div>

<!-- Line graph element -->
<div class="melon-chart">
    <canvas id="lineChart" width="100" height="30"></canvas>
    <div id="lineLegend" class="chart-legend"></div>
</div>

<script src="https://code.jquery.com/jquery.js"></script>
<script src="static/dashboard.js"></script>

<!-- Creates graphs using chart.js -->
<script>

   var options = {
      responsive: true
    };

    // Creates donut chart of frequency of occurrences of different types of insomnia
    var ctx_donut = $("#donutChart").get(0).getContext("2d");

    $.get("/insom-types.json", function (data) {
      var myDonutChart = new Chart(ctx_donut).Doughnut(data.insom_type, options);
      $('#donutLegend').html(myDonutChart.generateLegend());
    });

    // Reload chart based on user-selected date range. 
    // var formValues = $("#date-range").serialize();

    // $.get("/insom-types.json", formValues, function (data) {
    //   var myDonutChart = new Chart(ctx_donut).Doughnut(data.insom_type, options);
    //   $('#donutLegend').html(myDonutChart.generateLegend());
    // });

// ///////////////////////////////////////////////////////

// function showDeliveryTimes(results) {
//     console.dir(results); // yay debugging!
//     alert("This will cost $" + results.cost);
//     alert("This will arrive in " + results.days + " day(s)");
// }

// function getDeliveryInfo(evt) {
//     evt.preventDefault();

//     var formInputs = {
//         "city": $("#city-field").val(),
//         "address": $("#adr-field").val()
//     };

//     $.get("/delivery-info.json",
//         formInputs,
//         showDeliveryTimes);
// }

// $("#delivery-form").on("submit", getDeliveryInfo);

///////////////////////////////////////////////////////////////////

function updatePieChart(results) {
    var myDonutChart = new Chart(ctx_donut).Doughnut(results.insom_type, options);
      $('#donutLegend').html(myDonutChart.generateLegend());

}

function getDateRange(evt) {
    evt.preventDefault();

    var formInputs = {
        "start_date": $("#start_date").val(),
        "end_date": $("#end_date").val() 
    };

    $.get('/insom-types.json',
        formInputs,
        updatePieChart);
    
};

$("#date-range").on("submit", getDateRange);

    


    // // Creates donut chart of frequency of occurrences of different types of insomnia
    // var ctx_donut2 = $("#donutChart2").get(0).getContext("2d");

    // $.get("/insom-types.json", function (data) {
    //   var myDonutChart2 = new Chart(ctx_donut2).Doughnut(data.insom_type, options);
    //   $('#donut2Legend').html(myDonutChart2.generateLegend());
    // });


    // Creates line chart of insomnia severity over time
    var ctx_line = $("#lineChart").get(0).getContext("2d");

    $.get("/insom-severity.json", function (data) {
      var myLineChart = new Chart(ctx_line).Line(data, options);
      $("#lineLegend").html(myLineChart.generateLegend());
    });




</script>



{% endblock %}